#!/usr/bin/env python3
"""
–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ETF
–°–æ–∑–¥–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –≤—Å–µ–º–∏ –≤–∏–¥–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞
"""

import sys
import traceback
from datetime import datetime
from pathlib import Path

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
    
    print("üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö ETF")
    print("=" * 60)
    
    try:
        # 1. –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥
        print("\nüìä –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∞—à–±–æ—Ä–¥–∞...")
        from interactive_etf_dashboard import InteractiveETFDashboard
        
        dashboard = InteractiveETFDashboard()
        dashboard.load_data()
        
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏
        dashboard_file = dashboard.create_comprehensive_dashboard()
        if dashboard_file:
            print(f"‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–æ–∑–¥–∞–Ω: {dashboard_file}")
        
        # 2. –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
        print("\nüî¨ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...")
        from advanced_etf_analytics import AdvancedETFAnalytics
        
        analytics = AdvancedETFAnalytics()
        analytics_file = analytics.create_comprehensive_analysis()
        if analytics_file:
            print(f"‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: {analytics_file}")
        
        # 3. –°–æ–∑–¥–∞–µ–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        print("\nüí° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π...")
        recommendations = analytics.generate_investment_recommendations()
        
        if recommendations:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            rec_file = f"investment_recommendations_{timestamp}.md"
            
            with open(rec_file, 'w', encoding='utf-8') as f:
                f.write("# üí∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–º ETF\n\n")
                f.write(f"**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** {datetime.now().strftime('%d.%m.%Y %H:%M')}\n\n")
                
                for category, data in recommendations.items():
                    f.write(f"## {data['description']}\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞:** {data['criteria']}\n\n")
                    
                    if data['etfs']:
                        f.write("| –¢–∏–∫–µ—Ä | –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å | –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å | Sharpe Ratio |\n")
                        f.write("|-------|------------|---------------|---------------|\n")
                        
                        for etf in data['etfs'][:5]:  # –¢–æ–ø-5
                            f.write(f"| {etf['ticker']} | {etf.get('annual_return', 0):.1f}% | "
                                   f"{etf.get('volatility', 0):.1f}% | {etf.get('sharpe_ratio', 0):.2f} |\n")
                    else:
                        f.write("*–ù–µ—Ç ETF, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä–∏—Ç–µ—Ä–∏—è–º*\n")
                    
                    f.write("\n")
            
            print(f"‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {rec_file}")
        
        # 4. –°–æ–∑–¥–∞–µ–º —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç
        print("\nüìã –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞...")
        
        summary_file = f"advanced_analytics_summary_{datetime.now().strftime('%Y%m%d_%H%M%S')}.md"
        
        with open(summary_file, 'w', encoding='utf-8') as f:
            f.write("# üìä –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ ETF\n\n")
            f.write(f"**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** {datetime.now().strftime('%d.%m.%Y %H:%M')}\n\n")
            
            f.write("## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏\n\n")
            f.write("‚úÖ **–°–µ–∫—Ç–æ—Ä–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑** - –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∞–∫—Ç–∏–≤–æ–≤\n")
            f.write("‚úÖ **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞** - –ê–Ω–∞–ª–∏–∑ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π –º–µ–∂–¥—É ETF\n")
            f.write("‚úÖ **–†–∏—Å–∫-—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å** - –†–∞—Å—á–µ—Ç Sharpe –∏ Sortino –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤\n")
            f.write("‚úÖ **–ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–∞–≤–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è** - –ò–Ω—Å–∞–π—Ç—ã –¥–ª—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏\n")
            f.write("‚úÖ **–ê—Ç—Ä–∏–±—É—Ü–∏—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏** - –†–∞—Å—á–µ—Ç –∞–ª—å—Ñ—ã –∏ –±–µ—Ç—ã\n")
            f.write("‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã** - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏\n")
            f.write("‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞** - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π\n")
            f.write("‚úÖ **–î–∏–≤–∏–¥–µ–Ω–¥–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å** - –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑\n")
            f.write("‚úÖ **–ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤** - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ expense ratio\n")
            f.write("‚úÖ **–í–∑–≤–µ—à–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—Ñ–µ–ª–∏** - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è\n\n")
            
            f.write("## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\n\n")
            if dashboard_file:
                f.write(f"- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥:** `{dashboard_file}`\n")
            if analytics_file:
                f.write(f"- **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:** `{analytics_file}`\n")
            f.write(f"- **–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** `{rec_file}`\n")
            f.write(f"- **–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç:** `{summary_file}`\n\n")
            
            f.write("## üîç –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã\n\n")
            f.write("1. **–î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏\n")
            f.write("2. **–†–∏—Å–∫-–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å** - –í—ã—è–≤–ª–µ–Ω—ã ETF —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ–º —Ä–∏—Å–∫/–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å\n")
            f.write("3. **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏** - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥—Ä—É–ø–ø—ã ETF —Å –Ω–∏–∑–∫–æ–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π\n")
            f.write("4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è\n\n")
            
            f.write("## üéØ –§–æ–∫—É—Å –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π\n\n")
            f.write("–í—Å–µ –∞–Ω–∞–ª–∏–∑—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–∞—Ö:\n")
            f.write("- –í—ã–±–æ—Ä ETF –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π\n")
            f.write("- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å —É—á–µ—Ç–æ–º —Ä–∏—Å–∫–∞\n")
            f.write("- –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º –∏ –∞–∫—Ç–∏–≤–∞–º\n")
            f.write("- –ê–Ω–∞–ª–∏–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤–ª–∞–¥–µ–Ω–∏—è (expense ratio)\n")
            f.write("- –û—Ü–µ–Ω–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–±—ä–µ–º–æ–≤\n\n")
        
        print(f"‚úÖ –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: {summary_file}")
        
        print("\n" + "=" * 60)
        print("üéâ –ü–†–û–î–í–ò–ù–£–¢–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!")
        print("=" * 60)
        
        print(f"\nüìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:")
        if dashboard_file:
            print(f"   ‚Ä¢ {dashboard_file}")
        if analytics_file:
            print(f"   ‚Ä¢ {analytics_file}")
        print(f"   ‚Ä¢ {rec_file}")
        print(f"   ‚Ä¢ {summary_file}")
        
        return True
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:")
        print(f"   {str(e)}")
        print(f"\nüîç –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:")
        traceback.print_exc()
        return False

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)