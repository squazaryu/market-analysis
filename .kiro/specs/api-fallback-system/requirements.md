# Requirements Document

## Introduction

Система анализа российских ETF должна получать данные о доходности, составе портфелей, комиссиях и рыночных долях всех 96 фондов, торгующихся на MOEX. Из 10 протестированных API только 2 активны (Moscow Exchange и Yahoo Finance), что создает риск получения неполных данных. Необходимо расширить существующую систему fallback для анализа всех доступных ETF на российском рынке, а не только зарегистрированных в реестре ЦБ как БПИФ.

## Requirements

### Requirement 1

**User Story:** Как аналитик ETF, я хочу получать данные о всех 96 российских фондах, торгующихся на MOEX, из доступных источников, чтобы анализировать их доходность, состав и комиссии.

#### Acceptance Criteria

1. WHEN запрашиваются данные о ETF THEN система SHALL попытаться получить их из MOEX API для всех 96 фондов
2. WHEN MOEX API недоступен THEN система SHALL попытаться получить данные из Yahoo Finance
3. WHEN данные получены THEN система SHALL нормализовать их к единому формату
4. WHEN данные недоступны из всех источников THEN система SHALL вернуть информацию об ошибке
5. WHEN система запускается THEN она SHALL автоматически получить список всех ETF с MOEX

### Requirement 2

**User Story:** Как аналитик, я хочу получать полную информацию о всех 96 ETF включая доходность, волатильность, объемы торгов и состав портфеля, чтобы проводить комплексный анализ российского рынка ETF.

#### Acceptance Criteria

1. WHEN запрашиваются данные о ETF THEN система SHALL вернуть текущую цену, доходность за год и волатильность для всех 96 фондов
2. WHEN доступны данные об объемах THEN система SHALL вернуть средние дневные объемы торгов
3. WHEN доступна информация о составе THEN система SHALL вернуть основные активы фонда
4. WHEN данные получены из разных источников THEN система SHALL указать источник каждого показателя
5. WHEN анализируется весь рынок THEN система SHALL создать рейтинг ETF по доходности, объемам и другим показателям

### Requirement 3

**User Story:** Как аналитик, я хочу получать данные о рыночных долях управляющих компаний и комиссиях всех 96 ETF, чтобы понимать полную структуру российского рынка ETF.

#### Acceptance Criteria

1. WHEN анализируется рынок ETF THEN система SHALL рассчитать долю каждой управляющей компании среди всех 96 фондов
2. WHEN доступна информация о комиссиях THEN система SHALL вернуть expense ratio для каждого фонда
3. WHEN рассчитываются доли рынка THEN система SHALL использовать объемы торгов или активы под управлением
4. WHEN данные агрегируются THEN система SHALL создать сводный отчет по всем 96 ETF с рейтингами и сравнениями

### Requirement 4

**User Story:** Как пользователь системы, я хочу получать актуальные данные о всех 96 ETF с минимальными задержками, чтобы принимать обоснованные инвестиционные решения на основе полной картины рынка.

#### Acceptance Criteria

1. WHEN система не может получить данные из основного источника THEN она SHALL попробовать альтернативный источник в течение 10 секунд
2. WHEN данные получены успешно THEN система SHALL кэшировать их на 1 час для быстрого доступа
3. WHEN данные устарели THEN система SHALL автоматически обновить их при следующем запросе
4. WHEN все источники недоступны THEN система SHALL использовать последние кэшированные данные с предупреждением

### Requirement 5

**User Story:** Как аналитик рынка, я хочу получать полный анализ всех 96 ETF на MOEX с автоматическим обновлением списка фондов, чтобы не пропустить новые ETF и отслеживать изменения в составе рынка.

#### Acceptance Criteria

1. WHEN система запускается THEN она SHALL автоматически получить актуальный список всех ETF с MOEX
2. WHEN обнаружены новые ETF THEN система SHALL добавить их в анализ
3. WHEN ETF исключен из торгов THEN система SHALL пометить его как неактивный
4. WHEN проводится анализ THEN система SHALL обработать все активные ETF и создать полный отчет
5. WHEN создается отчет THEN он SHALL включать сравнение с предыдущими периодами и тренды

### Requirement 6

**User Story:** Как инвестиционный аналитик, я хочу получать глубокую аналитическую визуализацию всех ETF с фокусом на инвестиционные решения, чтобы выявлять лучшие возможности для портфельных инвестиций и понимать риски.

#### Acceptance Criteria

1. WHEN создается визуализация THEN система SHALL показать корреляционную матрицу между топ ETF для анализа диверсификации
2. WHEN анализируется риск THEN система SHALL рассчитать и визуализировать риск-скорректированную доходность (Sharpe ratio, Sortino ratio)
3. WHEN сравниваются ETF THEN система SHALL создать эффективную границу (efficient frontier) для оптимального портфеля
4. WHEN анализируется состав THEN система SHALL показать секторальное распределение и концентрацию активов
5. WHEN оценивается производительность THEN система SHALL показать attribution analysis (альфа, бета) относительно бенчмарков
6. WHEN создаются графики THEN система SHALL фокусироваться на инвестиционных инсайтах, а не на технических метриках системы